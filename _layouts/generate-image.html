<!doctype html>
<html lang='en' prefix='og: http://ogp.me/ns#'>

  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <title>generating {{ page.image_type }} image</title>
    <link rel='stylesheet' href='/assets/css/generate-image.css'>
    <script>
      // copy function from node_modules/unicode-encode/index.js so we don't have to compile
      function atou(str) {
        return decodeURIComponent(escape(atob(str)));
      }

      function paramsToObject(paramString) {
        const params = new URLSearchParams(paramString)
        const object = {}
        for (const [key, value] of params.entries()) {
          object[key] = value
        }
        return object
      }

      function replace(id, content, domAttr) {
        const element = document.getElementById(id)
        if(element) {
          element[domAttr] = content
        }
      }

      const urlParams = window.location.search.replace('?', '')
      // use atou to decode data
      const data = paramsToObject(atou(urlParams))

      document.addEventListener('DOMContentLoaded', function(){
        Object.entries(data).map(([key, value]) => {
          if (key === 'post-image' || key === 'author-image') {
            replace(key, value, 'src')
          } else {
            replace(key, value, 'innerHTML')
          }
        })
      })
    </script>
    <meta name="robots" content="noindex nofollow">
    {% include head/favicon.html %}
  </head>

  <body class='{{ page.image_type }}'>
    <div id='preview'>
      <footer>
        <!--<img id='logo' alt='' src='/android-chrome-192x192.png' />-->
        <p id='site-title'>@motionsplan</p>
      </footer>

      <section id='text'>
        <header>
          <img id='logo' alt='' src='/android-chrome-192x192.png' />
          <h1 id='site-title'>motionsplan.dk</h1>
        </header>

        <h2 id='post-title'></h2>

        <h3 id='post-excerpt'></h3>
  
        <section id='author'>
          <img id='author-image' alt='' src='' data-proofer-ignore>
          <p id='author-name'></p>
        </section>
      </section>

      <figure id='image'>
        <img id='post-image' alt='' src='' data-proofer-ignore>
      </figure>

    </div>
  </body>

</html>
